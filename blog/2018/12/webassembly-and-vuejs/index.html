<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>WebAssembly with vue.js &middot; Mirko Sertic</title><meta name="description" content="This posts shows how to integrate modern web technologies like WebAssembly and vue.js by using cross-compiler technologies."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="WebAssembly with vue.js"><meta property="og:description" content="This posts shows how to integrate modern web technologies like WebAssembly and vue.js by using cross-compiler technologies."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2018/12/webassembly-and-vuejs/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><script src="https://polyfill.io/v2/polyfill.min.js?features=default,IntersectionObserver"></script><meta name="theme-color" content="#ffffff"><script>var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-33614060-2', 'auto');
	
	ga('send', 'pageview');
}</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="Tools &amp; Goodies">Tools &amp; Goodies</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">WebAssembly with vue.js</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2018-12-20" itemprop="datePublished">Thu, Dec 20, 2018</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://twitter.com/mirkosertic" itemprop="url" rel="author">Mirko Sertic</a></span></span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>5 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/compiler">Compiler</a></span> ,&nbsp;<a href="/tags/interesting">Interesting</a> ,&nbsp;<a href="/tags/performance">Performance</a> ,&nbsp;<a href="/tags/javascript">JavaScript</a> ,&nbsp;<a href="/tags/html5">HTML5</a> ,&nbsp;<a href="/tags/web">Web</a> ,&nbsp;<a href="/tags/webassembly">WebAssembly</a></p></header><article class="post-content clearfix" itemprop="articleBody"><div class="sect1"><h2 id="_state_of_the_union">State of the union</h2><div class="sectionbody"><div class="paragraph"><p>WebAssembly for starters is a standard for high-performance, size-optimized executable code for the Web. It was released in March 2017 by the <a href="https://www.w3.org/wasm/">WebAssembly working group</a> as version 1.0, which is basically a MVP (Minimum Viable Product), but the initial development started in June 2017. WebAssembly is the successor <a href="http://asmjs.org/">asm.js</a> and the <a href="https://developer.chrome.com/native-client">Google Native Client (NaCL)</a>.</p></div><div class="paragraph"><p>WebAssembly itself is merely a sandboxed runtime environment. It was designed as a compile target. High level languages such as C/C++, Rust, .NET or Java can be compiled to WebAssembly. As a compile target, it implements a set of binary opcodes, a module system and a stack machine making the opcodes executable. Modern compiler can translate and optimize high level languages to low level WebAssembly modules.</p></div><div class="paragraph"><p>WebAssembly 1.0 is a MVP. As a <a href="https://en.wikipedia.org/wiki/Minimum_viable_product">Minimum viable product</a> it is focused on an extensible core system. The core supports the mentioned instruction set, has support for modules and a virtual, linear memory and a limited set of data types such as integers and floating point numbers. It does not support high level structures such as arrays and objects. It also does not implement memory management. All those things must be implemented by the language emulation layer generated by the compiler. The MVP does also not support direct browser API interaction. This makes it tricky to write applications for the Web, as basically all known applications need some kind of user interaction, which is HTML and JavaScript. A compiler therefore needs to generate runtime linkage code, which emulates or delegates to the browser API and makes them available to the WebAssembly bytecode using the WebAssembly module system. In the following chapters I want to show you a compiler which can compile Java Bytecode to WebAssembly. In this short demo, I will also show you how user interaction can be implemented by WebAssembly based on a modern framework: vue.js. Say hello to <a href="https://github.com/mirkosertic/Bytecoder">Bytecoder</a>!</p></div></div></div><div class="sect1"><h2 id="_bytecoder">Bytecoder</h2><div class="sectionbody"><div class="paragraph"><p>Bytecoder is a rich domain model for Java(JVM) bytecode and framework to interpret and transpile it to other languages such as JavaScript, OpenCL or WebAssembly. Its high level goals are:</p></div><div class="ulist"><ul><li><p>Ability to cross-compile JVM bytecode to JavaScript, WebAssembly, OpenCL and other languages</p></li><li><p>Primary compile targets are JavaScript and WebAssembly</p></li><li><p>Allow integration with other UI-Frameworks such as vue.js</p></li><li><p>Use other tool chains such as Google Closure Compiler to further optimize generated code</p></li><li><p>Backed by OpenJDK 11 as JRE Classlib</p></li></ul></div><div class="paragraph"><p>The JVM bytecode is parsed and transformed into an intermediate representation. This intermediate representation is passed thru optimizer stages and sent to a backend implementation for target code generation.</p></div><div class="paragraph"><p>The JavaScript backend transforms the intermediate representation into JavaScript.</p></div><div class="paragraph"><p>The WebAssembly backend transforms the intermediate representation into WebAssembly text and binary code.</p></div><div class="paragraph"><p>The OpenCL backend is used to compile single algorithms into OpenCL and execute them on the GPU. This backend is designed to enhance existing programs running on the JVM to utilize the vast power of modern GPUs.</p></div><div class="paragraph"><p>Ok, Bytecoder can compile Java/JVM bytecode to WebAssembly. How can I do some user interaction, and can I use my favorite UI framework for this? Yes, you can! For this demo, I will use <a href="https://vuejs.org/">vue.js</a>.</p></div></div></div><div class="sect1"><h2 id="_vue_js_bytecoder_integration">Vue.js Bytecoder integration</h2><div class="sectionbody"><div class="paragraph"><p>Bytecoder comes with a <a href="https://openjdk.java.net/">OpenJDK</a> 11 classlib. Unfortunately there are two parts for successful vue.js and WebAssembly integration missing. We do not have a vue.js Java API, and we do now have a way to instruct the compiler to generate the required WebAssembly runtime linkage code to make vue.js available to the WebAssembly sandbox.</p></div><div class="paragraph"><p>But there is rescue. Bytecoder has a OpaqueReferenceType API. This API is a set of Java interfaces to model the interaction with browser APIs such as the DOM or third party libraries such as vue.js. The OpaqueReferenceType API is based on the WebAssembly <a href="https://github.com/WebAssembly/reference-types">Reference Types Proposal</a>, which might be integrated someday into the next official WebAssembly release. So now, show me the money! How can be write a program that can be compiled to WebAssembly with effective vue.js binding? Well, here it is!</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">import de.mirkosertic.bytecoder.api.OpaqueProperty; <i class="conum" data-value="1"></i><b>(1)</b>
import de.mirkosertic.bytecoder.api.vue.Vue;
import de.mirkosertic.bytecoder.api.vue.VueBuilder;
import de.mirkosertic.bytecoder.api.vue.VueEventListener;
import de.mirkosertic.bytecoder.api.vue.VueInstance;
import de.mirkosertic.bytecoder.api.web.ClickEvent;

public class VueDemo {

    public interface MyVueInstance extends VueInstance {

        @OpaqueProperty
        void welcomemessage(String aNewMessage);
    }

    public static void main(String[] args) { <i class="conum" data-value="2"></i><b>(2)</b>

        VueBuilder theBuilder = Vue.builder(); <i class="conum" data-value="3"></i><b>(3)</b>
        theBuilder.bindToTemplateSelector(&#34;#vuetemplate&#34;); <i class="conum" data-value="4"></i><b>(4)</b>
        theBuilder.data().setProperty(&#34;welcomemessage&#34;, &#34;hello world!&#34;); <i class="conum" data-value="4"></i><b>(4)</b>
        theBuilder.addEventListener(&#34;clicked&#34;, new VueEventListener() { <i class="conum" data-value="5"></i><b>(5)</b>
            @Override
            public void handle(MyVueInstance instance, ClickEvent event) {
                instance.welcomemessage(&#34;Timestamp is &#34; + System.currentTimeMillis());
            }
        });
        MyVueInstance instance = theBuilder.build(); <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>We need to import the Bytecoder OpaqueReference API</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>The main method is the entry point for the WebAssembly program</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>A VueBuilder is used to create one or more vue.js component instances</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>The builder is bound to a HTML template and initialized with some core data properties</td></tr><tr><td><i class="conum" data-value="5"></i><b>5</b></td><td>We can also do callbacks from the vue.js API to WebAssembly. The binding code is generated by the compiler.</td></tr><tr><td><i class="conum" data-value="6"></i><b>6</b></td><td>This will summon the full vue.js magic</td></tr></tbody></table></div><div class="paragraph"><p>This program also needs a HTML template:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-html" data-lang="html">&lt;style&gt;
    [v-cloak] {
        display: none;
    }
&lt;/style&gt;
&lt;div v-cloak id=&#34;vuetemplate&#34;&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;h1&gt;Hello, this is a vue.js instance running with WebAssembly&lt;/h1&gt;
    &lt;span&gt;Current message : {{welcomemessage}}&lt;/span&gt;
    &lt;button v-on:click=&#34;clicked&#34;&gt;Click me to change the message!&lt;/button&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/div&gt;</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>HTML element with id &#34;vuetemplate&#34; is referenced in the Java code</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Click listener &#34;clicked&#34; was registered in the Java code</td></tr></tbody></table></div><div class="paragraph"><p>The Bytecoder API also needs the implementation logic for the VueBuilder interface:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-javascript" data-lang="javascript">bytecoder.imports.vue = {
    builder : function() {
        var builder = {
            config : {
                data: {
                    setProperty: function(name, value) {
                        this[name] = value;
                    }
                },
                methods: {
                },
            },
            bindToTemplateSelector: function(aSelectorStr) {
                this.config.el = aSelectorStr;
            },
            data: function() {
                return this.config.data;
            },
            addEventListener: function(eventName,listenerFunction) {
                this.config.methods[eventName] = function() {
                    var args = Array.prototype.slice.call(arguments);
                    args.unshift(this);
                    listenerFunction.apply(this, args);
                }
            },
            build: function() {
                var v = new Vue(this.config);
                v.setProperty = function(name, value) {
                    v[name] = value;
                };
                return v;
            }
        };
        return bytecoder.toBytecoderReference(builder);
    }
};</code></pre></div></div><div class="paragraph"><p>This import is an example of the WebAssembly module system. WebAssembly allows us to import functionality from outside of its sandbox and call it at runtime.</p></div></div></div><div class="sect1"><h2 id="_conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Bytecoder makes it easy to use a wide spread high level language and compile it to high efficiency runtime environments like WebAssembly. The OpaqueReferenceType API combined with modern frameworks like vue.js allows us to fill the missing parts of the WebAssembly core specification. The Bytecoder transpiler is a great tool to keep developer productivity high by using high level languages and also keep runtime costs low. WebAssembly rocks!</p></div></div></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2018/02/alicebobcaroldaveopencl/">Alice, Bob, Carol and Dave OpenCL Edition</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2019/04/java-desktop-packaging/">Packaging JavaFX Applications for the Desktop</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/1495e2e1a99d95cc7c62ee41b0957dc192ea135c" target="_blank">1495e2e</a></p></article></div><div class="comments"><div id="disqus-placeholder">Loading comments...</div><div id="disqus_thread"></div><script>'use strict';
        window.addEventListener("load", function(event) {
            var disqusLoaded = false;
            var disqusObserver = new IntersectionObserver(function(entries, observer) {
                entries.forEach(function(entry) {
                    if (!disqusLoaded && entry.isIntersecting) {
                        console.log("Loading Disqus");
                        disqusLoaded = true;

                        document.getElementById('disqus-placeholder').remove();

                        
                        var script = document.createElement('script');
                        script.src = '//www-mirkosertic-de.disqus.com/embed.js';
                        script.async = true;
                        script.setAttribute('data-timestamp', +new Date());
                        script.addEventListener('load', function () {
                            
                            DISQUS.reset({reload: true, config: false});
                        });
                        (document.head || document.body).appendChild(script);
                    }
                });
            }, {
                root: null,
                rootMargin: "0px",
                threshold: [0]
            });
            disqusObserver.observe(document.querySelector(".comments"));
        }, false);</script></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://www.mirkosertic.de/index.xml" itemprop="url"><i class="fa fa-rss-white"></i></a> <a class="icon" target="_blank" href="https://www.xing.com/profile/Mirko_Sertic" itemprop="url"><i class="fa fa-xing-white"></i></a> <a class="icon" target="_blank" href="https://twitter.com/mirkosertic" itemprop="url"><i class="fa fa-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>