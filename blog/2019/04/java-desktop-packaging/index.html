<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Packaging JavaFX Applications for the Desktop &middot; Mirko Sertic</title><meta name="description" content="Packaging Java applications for the Desktop has never been an easy task. In this blog post I want to look at the past to show where we are coming from, look at the present to see what we have now and finally try to take a look into the future to get a glimpse of what might be coming."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="Packaging JavaFX Applications for the Desktop"><meta property="og:description" content="Packaging Java applications for the Desktop has never been an easy task. In this blog post I want to look at the past to show where we are coming from, look at the present to see what we have now and finally try to take a look into the future to get a glimpse of what might be coming."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2019/04/java-desktop-packaging/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><script src="https://polyfill.io/v2/polyfill.min.js?features=default,IntersectionObserver"></script><meta name="theme-color" content="#ffffff"><script>var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-33614060-2', 'auto');
	
	ga('send', 'pageview');
}</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="Tools &amp; Goodies">Tools &amp; Goodies</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">Packaging JavaFX Applications for the Desktop</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2019-04-23" itemprop="datePublished">Tue, Apr 23, 2019</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://twitter.com/mirkosertic" itemprop="url" rel="author">Mirko Sertic</a></span></span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>8 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/java">Java</a></span> ,&nbsp;<a href="/tags/javafx">JavaFX</a> ,&nbsp;<a href="/tags/packaging">Packaging</a> ,&nbsp;<a href="/tags/native">Native</a> ,&nbsp;<a href="/tags/graalvm">GraalVM</a></p></header><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>Packaging Java applications for the Desktop has never been an easy task. In this blog post I want to look at the past to show where we are coming from, look at the present to see what we have now and finally try to take a look into the future to get a glimpse of what might be coming.</p></div><div class="sect1"><h2 id="_the_past_of_java_packaging">The Past of Java Packaging</h2><div class="sectionbody"><div class="paragraph"><p>Before Java 5.0 there was no built-in support in Java for application distribution, as far as what we would consider an application. But there was hope. We had <a href="https://www.oracle.com/technetwork/java/applets-137637.html">Java Applets</a>. Applets used to be Java programs executed by a special plugin installed in our browser. This plugin downloaded the jar files of the applet, and executed the code in an isolated, restricted sandbox. We used signed applets to escape this sandbox and get full access to system resources. One problem remained: there was no built-in update mechanism. We only had the browser cache to prevent jar files from being downloaded every time.</p></div><div class="paragraph"><p>The world changed a bit with Java 1.4.2. This major release introduced <a href="https://www.oracle.com/technetwork/java/javase/archive-download-142935.html">Java WebStart</a>. Java WebStart was meant to fill the gap applets had left open. It introduced the same isolated sandboxes we had with Applets, but we also got a managed cache for downloaded application artifacts, We also got a new file format, the JNLP file, to describe the application and its system requirements. Everything was well, beside the fact that we still needed a browser plugin to interpret the JNLP file and to launch it in the browser context. Yet we could handle the JNLP file as a simple download, and launch the WebStart binary after downloading it. This was not very common, as security issues started to arise. Downloading files from the internet without checking their content is evil right?</p></div><div class="paragraph"><p>Starting with Java 8, developers got another tool for software distribution: <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/deploy/packager.html">Java Packager</a>. JavaPackager created platform specific binaries, including the Java runtime and the application itself. Creating this kind of installer was always possible in the world of Java, but now there was a built-in tool supporting this.</p></div><div class="paragraph"><p>Things started to get complicated. Browser plugins became very unpopular, including the required Java plugin. Browser vendors started to <a href="https://java.com/en/download/faq/firefox_java.xml">remove required APIs</a> for the plugins, and WebStart could only be used in special LTS versions of common browsers. Finally, Oracle decided to no longer support WebStart. All APIs became deprecated with Java 9, and will be removed in the future. It is even getting more confusing as javapackager is no longer part of Java 11 and Java 12. Some people <a href="https://mail.openjdk.java.net/pipermail/openjfx-dev/2018-September/022500.html">ported javapackager</a> to Java 11, but with Java 12 it is gone.</p></div></div></div><div class="sect1"><h2 id="_the_presence_of_java_packaging">The Presence of Java Packaging</h2><div class="sectionbody"><div class="paragraph"><p>Currently, we have Java 12 without any build-in packaging tool. But there is hope! <a href="https://openjdk.java.net/jeps/343">JPackage</a> is the new tool for packaging self-contained Java applications.</p></div><div class="paragraph"><p>Now, what is JPackage? JPackage is a command line tool. It takes an application and a JVM image and creates platform specific bundles from then. It creates exe and msi files on Windows for example, and deb and rpms for Linux. The problem is: it is currently only available as an early-access build for Java 14! What to do now? Must be build our application with this early access thing? It turns out: no!</p></div><div class="paragraph"><p>As mentioned, JPackage takes an application and an jvm image as inputs. We can use the early access JPackage binary and use it to create a native bundle from an application and an Java 12 runtime image! Pretty cool, right?</p></div><div class="paragraph"><p>To create an installer for an application, we have to</p></div><div class="ulist"><ul><li><p>Download <a href="https://adoptopenjdk.net/">OpenJDK 12</a></p></li><li><p>Download <a href="https://jdk.java.net/jpackage/">JPackage</a></p></li><li><p>Point JAVA_HOME to the OpenJDK 12 installation</p></li><li><p>Point JPACKAGE_HOME to the JPackage installation</p></li><li><p>Install fakeroot and rpm packages if we are on Linux</p></li><li><p>Install <a href="http://www.jrsoftware.org/isinfo.php">Inno Setup</a> and <a href="http://wixtoolset.org/">Wix Toolset</a> if we are on Windows</p></li></ul></div><div class="paragraph"><p>Now we can invoke the JPackage tool in a very general way:</p></div><div class="listingblock"><div class="title">package.sh</div><div class="content"><pre>$JPACKAGE_HOME/bin/jpackage <i class="conum" data-value="1"></i><b>(1)</b>
    --package-type rpm
    --runtime-image $JAVA_HOME <i class="conum" data-value="2"></i><b>(2)</b>
    ..rest of required arguments</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Invoking the jpackage binary</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Passing in the OpenJDK 12 installation as runtime image</td></tr></tbody></table></div><div class="paragraph"><p>I’ve left out all other required command line arguments for clarification. Please take a look at the JEP documentation or just checkout <a href="https://github.com/mirkosertic/FXDesktopSearch">FXDesktopSearch</a>, which includes a working Maven pom to see the whole packaging process in action. The tricky part are the cross platform builds. We have to invoke JPackage for Windows builds in a different way than Linux builds. This is encapsulated in my example by Maven Profiles.</p></div><div class="paragraph"><p>There are other subtle issues around. JPackage does not support cross platform builds. We have to invoke the tool on a Windows box to get Windows binaries, on a Linux box to get Linux binaries and so on. If we have a Windows 10 64bit machine, there is a neat trick available. Say hello to the <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Microsoft Windows Subsystem for Linux</a>!</p></div><div class="paragraph"><p>The Windows Subsystem for Linux is a cool thing. It is basically a running Linux shell (Ubuntu for instance) on our Windows desktop. We can do all the cool Linux stuff, and use all the Linux tools, but on a running Windows machine, without installing VirtualBox or VMWare. We can also access the whole Windows file systems from Linux shell side by using special mount points.</p></div><div class="paragraph"><p>This introduces a pretty cool way to create true cross platform builds without having multiple build servers! We can create the Windows binaries by invoking JPackage on Windows, then switch to the Windows Linux Subsystem and invoke it to create the Linux binaries! Now, how long does my FXDesktopSearch example build take on Windows? Well…​</p></div><div class="listingblock"><div class="title">windowsbuild</div><div class="content"><pre>[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:45 min
[INFO] Finished at: 2019-04-23T13:34:18+02:00
[INFO] Final Memory: 59M/207M
[INFO] ------------------------------------------------------------------------</pre></div></div><div class="listingblock"><div class="title">linuxbuild</div><div class="content"><pre>[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  02:35 min
[INFO] Finished at: 2019-04-23T11:39:17Z
[INFO] ------------------------------------------------------------------------</pre></div></div><div class="paragraph"><p>The Subsystem for Linux needs some configuration to make it work properly with JPackage. First, JPackage relies on fakeroot. Fakeroot does not work property, we have to use <a href="https://github.com/Microsoft/WSL/issues/2132">fakeroot-tcp</a>. This can be easily configured by:</p></div><div class="listingblock"><div class="title">configurefakeroot.sh</div><div class="content"><pre>sudo update-alternatives --set fakeroot /usr/bin/fakeroot-tcp</pre></div></div><div class="paragraph"><p>Then we have to configure file permissions. Add the following configuration section to the wsl.conf inside of the Linux shell:</p></div><div class="listingblock"><div class="title">/etc/wsl.conf</div><div class="content"><pre>[automount]
enabled = true
root = /mnt/
options = &#34;metadata,umask=22,fmask=11&#34;</pre></div></div><div class="paragraph"><p>and we have to set the right umask:</p></div><div class="listingblock"><div class="title">~/.bashrc</div><div class="content"><pre>umask 0022</pre></div></div><div class="paragraph"><p>Oh, and by the way: to launch graphical user interfaces from the Linux subsystem, we have to install an <a href="https://sourceforge.net/projects/xming/">X11 server</a> on our Windows machine and set the DISPLAY variable on Linux side accordingly:</p></div><div class="listingblock"><div class="title">~/.bashrc</div><div class="content"><pre>export DISPLAY=:0</pre></div></div><div class="paragraph"><p>We now have a working cross platform build environment. The last open point is software package distribution. App stores are very popular today. So why not distribute our Java applications using an App Store?</p></div><div class="paragraph"><p>We already have platform specific packages available. How would be publish a Windows build into the Microsoft Office Store? It turns out, this is pretty straightforward. We just have to convert the msi files to msix files by using the MSIX Packaging Tool, which can also be downloaded from the Microsoft App Store. The result of the conversion can then be <a href="https://docs.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-run-desktop-app-converter">published</a>.</p></div><div class="paragraph"><p>It might not be possible for some applications to publish them into a public store. The Microsoft world also has a solution for this. Microsoft introduced a feature called <a href="https://docs.microsoft.com/en-us/windows/msix/app-installer/app-installer-root">AppInstaller</a>, which is a similar concept we had with Java WebStart and JNLP files. With a major differece: there is no need for browser plugins or third party tools anymore, the AppInstaller protocol and infrastructure is linked into the Windows 10 operating system!</p></div></div></div><div class="sect1"><h2 id="_the_future_of_java_packaging">The Future of Java Packaging</h2><div class="sectionbody"><div class="paragraph"><p>This part is tricky. From my point of view the trend seems to create platform specific bundles for cross-platform Java applications. This can even be taken a step further by using a complete new way of packaging, we just get rid of the whole JVM and application images and create platform specific binaries by using an ahead-of-time compiler. We enter the world of the holy <a href="https://www.graalvm.org/">Graal</a>. Sorry about this bad joke!</p></div><div class="paragraph"><p>GraalVM is a cool new system based on Oracle’s Substrate VM. It might replace the whole JVM one day, but before this can happen a lot of things need to be adapted to make them compatible with native ahead of time compilation. Lets check this out. GraalVM only works on Linux and Mac systems, so let’s start by running it with FXDesktopSearch in the Windows Linux Subsystem:</p></div><div class="listingblock"><div class="title">GraalVM.sh</div><div class="content"><pre>~/graalvm-ce-1.0.0-rc15/bin/native-image -cp ./lib:FXDesktopSearch.jar de.mirkosertic.desktopsearch.DesktopSearch
Build on Server(pid: 3139, port: 54204)
[de.mirkosertic.desktopsearch.desktopsearch:3139]    classlist:     337.20 ms
Fatal error: java.lang.UnsupportedClassVersionError: de/mirkosertic/desktopsearch/DesktopSearch has been compiled by a more recent version of the Java Runtime (class file version 56.0), this version of the Java Runtime only recognizes class file versions up to 52.0
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:468)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:74)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:369)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:363)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:362)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:348)
        at com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:238)
        at com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:422)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.executeCompilation(NativeImageBuildServer.java:390)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.lambda$processCommand$8(NativeImageBuildServer.java:327)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.withJVMContext(NativeImageBuildServer.java:408)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.processCommand(NativeImageBuildServer.java:324)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.processRequest(NativeImageBuildServer.java:268)
        at com.oracle.svm.hosted.server.NativeImageBuildServer.lambda$serve$7(NativeImageBuildServer.java:228)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:748)
Error: Image build request failed with exit status 1</pre></div></div><div class="paragraph"><p>Oops. GraalVM currently does not support Java 12. It currently can only read Java class files with byte code version up to Java 8. So unfortunately GraalVM is no option (yet) for packaging, but I will stay up to date and give it a try when new versions become available.</p></div><div class="paragraph"><p>So, thank you for reading! Feel free to leave a comment, I am always glad to help!</p></div></div></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2018/12/webassembly-and-vuejs/">WebAssembly with vue.js</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2021/04/scs-light-and-shadow/">Self-Contained-Systems Light &amp; Shadow</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/cde32e64165c8dfaa9eb7a48ad4fb69b3490e03b" target="_blank">cde32e6</a></p></article></div><div class="comments"><div id="disqus-placeholder">Loading comments...</div><div id="disqus_thread"></div><script>'use strict';
        window.addEventListener("load", function(event) {
            var disqusLoaded = false;
            var disqusObserver = new IntersectionObserver(function(entries, observer) {
                entries.forEach(function(entry) {
                    if (!disqusLoaded && entry.isIntersecting) {
                        console.log("Loading Disqus");
                        disqusLoaded = true;

                        document.getElementById('disqus-placeholder').remove();

                        
                        var script = document.createElement('script');
                        script.src = '//www-mirkosertic-de.disqus.com/embed.js';
                        script.async = true;
                        script.setAttribute('data-timestamp', +new Date());
                        script.addEventListener('load', function () {
                            
                            DISQUS.reset({reload: true, config: false});
                        });
                        (document.head || document.body).appendChild(script);
                    }
                });
            }, {
                root: null,
                rootMargin: "0px",
                threshold: [0]
            });
            disqusObserver.observe(document.querySelector(".comments"));
        }, false);</script></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://www.mirkosertic.de/index.xml" itemprop="url"><i class="fa fa-rss-white"></i></a> <a class="icon" target="_blank" href="https://www.xing.com/profile/Mirko_Sertic" itemprop="url"><i class="fa fa-xing-white"></i></a> <a class="icon" target="_blank" href="https://twitter.com/mirkosertic" itemprop="url"><i class="fa fa-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>