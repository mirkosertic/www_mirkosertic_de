<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>How to create JUnit assertions from running applications &middot; Mirko Sertic</title><meta name="description" content="JUnit is a cool and powerful framework for unit test creation. But there is a drawback: we need to create a lot of assertions! Without assertions, we can create a very good path coverage, but it is not guaranteed that the code works correctly. This can be really cumbersome while we are working with big JavaBeans or Entities. Check for instance the following piece of code:"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="How to create JUnit assertions from running applications"><meta property="og:description" content="JUnit is a cool and powerful framework for unit test creation. But there is a drawback: we need to create a lot of assertions! Without assertions, we can create a very good path coverage, but it is not guaranteed that the code works correctly. This can be really cumbersome while we are working with big JavaBeans or Entities. Check for instance the following piece of code:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2013/10/how-to-create-junit-assertions-from-running-applications/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><script src="https://polyfill.io/v2/polyfill.min.js?features=default,IntersectionObserver"></script><meta name="theme-color" content="#ffffff"><script type="application/javascript">var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-33614060-2', 'auto');
	
	ga('send', 'pageview');
}</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="Tools &amp; Goodies">Tools &amp; Goodies</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">How to create JUnit assertions from running applications</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2013-10-01" itemprop="datePublished">Tue, Oct 1, 2013</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://twitter.com/mirkosertic" itemprop="url" rel="author">Mirko Sertic</a></span></span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>3 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/interesting">Interesting</a></span> ,&nbsp;<a href="/tags/junit">JUnit</a> ,&nbsp;<a href="/tags/testing">Testing</a></p></header><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>JUnit is a cool and powerful framework for unit test creation. But there is a drawback: we need to create a lot of assertions! Without assertions, we can create a very good path coverage, but it is not guaranteed that the code works correctly. This can be really cumbersome while we are working with big JavaBeans or Entities. Check for instance the following piece of code:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class BeanTest {

    @Test
    public void testCreate() {
        ClassToTest theCandidate = new ClassToTest();
        TestBean theTestBean = theCandidate.create();

        // Here we need to generate assertions?
        System.out.println(theTestBean);
    }
}</code></pre></div></div><div class="paragraph"><p>Wouldn’t it be cool to just execute it and generate the unit test assertions from a running application instance, so we can get the following?</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class BeanTest {

    @Test
    public void testCreate() {
        ClassToTest theCandidate = new ClassToTest();
        TestBean theTestBean = theCandidate.create();

        // Here we need to generate assertions?
        System.out.println(theTestBean);

        Assert.assertEquals(&#34;Name1&#34;, theTestBean.getName1());
        Assert.assertNull(theTestBean.getName2());
        Assert.assertEquals(Integer.valueOf(1), theTestBean.getValue1());
        Assert.assertEquals(Boolean.valueOf(true), theTestBean.getValue2());
        Assert.assertEquals(Double.valueOf(3.0d), theTestBean.getValue3());
    }
}</code></pre></div></div><div class="paragraph"><p>So how do we create the missing unit test assertions? Just step into the unit test using a debugger and evaluate the following expression in the shell:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">AssertGen.generate(theTestBean)</code></pre></div></div><div class="paragraph"><p>And you will get the missing assertion statements. Now we can copy them to the original unit test source and rerun it again. Pretty cool, this can save a lot of time while writing unit test. But how does it work under the hood? The AssertGen class is quite simple, just check the source:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class AssertGen {

    public static String generate(Object aObject) throws InvocationTargetException, IllegalAccessException {
        StringWriter theStringWriter = new StringWriter();
        PrintWriter thePW = new PrintWriter(theStringWriter);
        if (aObject instanceof List) {
            List theList = (List) aObject;
            thePW.println(&#34;Assert.assertEquals(&#34; + theList.size() + &#34;, ob.size());&#34;);
            int row = 0;
            for (Object theObject : theList) {
                generate(thePW, &#34;ob.get(&#34; + row + &#34;).&#34;, theObject);
                row++;
            }
        } else {
            generate(thePW, &#34;ob.&#34;, aObject);
        }
        thePW.flush();
        return theStringWriter.toString();
    }

    private static void generate(PrintWriter aPW, String aPrefix, Object aObject) throws InvocationTargetException,
            IllegalAccessException {
        for (Method theMethod : aObject.getClass().getMethods()) {
            if (Modifier.isPublic(theMethod.getModifiers()) &amp;amp;&amp;amp; theMethod.getParameterTypes().length == 0) {
                String theMethodName = theMethod.getName();
                if (!theMethodName.equals(&#34;getClass&#34;) &amp;amp;&amp;amp; theMethodName.startsWith(&#34;get&#34;) || (theMethodName.startsWith(&#34;is&#34;))) {
                    Object theValue = theMethod.invoke(aObject);
                    if (theValue == null) {
                        aPW.println(&#34;Assert.assertNull(&#34; + aPrefix + theMethod.getName() + &#34;());&#34;);
                    } else {
                        aPW.println(&#34;Assert.assertEquals(&#34; + toAssertionText(theValue) + &#34;,&#34; + aPrefix
                                + theMethod.getName() + &#34;());&#34;);
                    }
                }
            }
        }
    }

    private static String toAssertionText(Object aValue) {
        if (aValue instanceof String) {
            return &#34;\&#34;&#34; + aValue + &#34;\&#34;&#34;;
        }
        if (aValue instanceof Integer) {
            return &#34;Integer.valueOf(&#34; + aValue + &#34;)&#34;;
        }
        if (aValue instanceof Long) {
            return &#34;Long.valueOf(&#34; + aValue + &#34;L)&#34;;
        }
        if (aValue instanceof Boolean) {
            return &#34;Boolean.valueOf(&#34; + aValue + &#34;)&#34;;
        }
        if (aValue instanceof Double) {
            return &#34;Double.valueOf(&#34; + aValue + &#34;d)&#34;;
        }
        if (aValue instanceof Timestamp) {
            Timestamp theTS = (Timestamp) aValue;
            return &#34;new Timestamp(&#34; + theTS.getTime() + &#34;L)&#34;;
        }

        return &#34;don&#39;t know to convert : &#34; + aValue;
    }
}</code></pre></div></div><div class="paragraph"><p>Nice, i really love JUnit!</p></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2013/09/domain-driven-design-with-jsf-ejb-and-cdi/">Domain-driven Design with JSF, EJB and CDI</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2013/10/java-se-context-and-dependency-injection-with-java-ee-support/">Java SE Context and Dependency Injection with Java EE support</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/63a36b07236d1869ff91cec0ebccf5aa005e0057" target="_blank">63a36b0</a></p></article></div><div class="comments"><div id="disqus-placeholder">Loading comments...</div><div id="disqus_thread"></div><script>'use strict';
        window.addEventListener("load", function(event) {
            var disqusLoaded = false;
            var disqusObserver = new IntersectionObserver(function(entries, observer) {
                entries.forEach(function(entry) {
                    if (!disqusLoaded && entry.isIntersecting) {
                        console.log("Loading Disqus");
                        disqusLoaded = true;

                        document.getElementById('disqus-placeholder').remove();

                        
                        var script = document.createElement('script');
                        script.src = '//www-mirkosertic-de.disqus.com/embed.js';
                        script.async = true;
                        script.setAttribute('data-timestamp', +new Date());
                        script.addEventListener('load', function () {
                            
                            DISQUS.reset({reload: true, config: false});
                        });
                        (document.head || document.body).appendChild(script);
                    }
                });
            }, {
                root: null,
                rootMargin: "0px",
                threshold: [0]
            });
            disqusObserver.observe(document.querySelector(".comments"));
        }, false);</script></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://www.mirkosertic.de/index.xml" itemprop="url"><i class="fa fa-rss-white"></i></a> <a class="icon" target="_blank" href="https://www.xing.com/profile/Mirko_Sertic" itemprop="url"><i class="fa fa-xing-white"></i></a> <a class="icon" target="_blank" href="https://twitter.com/mirkosertic" itemprop="url"><i class="fa fa-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https:\/\/www.mirkosertic.de\/js/highlight-9.9.0.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https:\/\/www.mirkosertic.de\/css/highlight.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.initHighlightingOnLoad();
        });
    }</script></body></html>