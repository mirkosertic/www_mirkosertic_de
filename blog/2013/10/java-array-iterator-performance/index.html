<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>The Hidden Cost of Array Iteration: A Java Performance Deep Dive &middot; Mirko Sertic</title><meta name="description" content="Ever wondered why some array iterations are 50 times slower than others? This fascinating deep-dive into Java array performance reveals surprising findings about cache efficiency and iteration patterns, demonstrating how simple changes in array access patterns can lead to dramatic performance differences."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="The Hidden Cost of Array Iteration: A Java Performance Deep Dive"><meta property="og:description" content="Ever wondered why some array iterations are 50 times slower than others? This fascinating deep-dive into Java array performance reveals surprising findings about cache efficiency and iteration patterns, demonstrating how simple changes in array access patterns can lead to dramatic performance differences."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2013/10/java-array-iterator-performance/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="My personal Technology Radar">Technology Radar</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><div class="contentbox"><h1 class="post-title" itemprop="name headline">The Hidden Cost of Array Iteration: A Java Performance Deep Dive</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2013-10-13" itemprop="datePublished">Sun, Oct 13, 2013</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://x.com/mirkosertic" itemprop="url" rel="author">Mirko Sertic</a></span></span></p><p class="post-abstract" itemprop="abstract"><span>This technical analysis explores performance implications of different array iteration strategies in Java, comparing row-order versus column-order traversal in multi-dimensional arrays. Through practical code examples, it demonstrates how cache-friendly access patterns can result in up to 50x performance improvements. The article also examines alternative approaches using single-dimensional arrays and the Arrays.fill() method, providing valuable insights for optimizing array operations in Java applications. Key findings suggest avoiding multi-dimensional arrays when performance is critical and considering cache-friendly iteration patterns for optimal execution speed.</span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>3 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/interesting">Interesting</a> ,<a href="/tags/performance">Performance</a></span></p></div></header><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>Lets check a very simple example: we want to fill a multi-dimensional array with values. What is the fastest way to do so? The following piece of code gives us surprising results:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class CacheTest {

    final int SIZE = 256;

    void rowOrderTest() {
        int theArray[][][] = new int[SIZE][SIZE][SIZE];
        long theTime = System.currentTimeMillis();
        for (int i = 0; i &lt;SIZE; i++) {
            for (int j = 0; j &lt;SIZE; j++) {
                for (int k = 0; k &lt;SIZE; k++) {
                    theArray[i][j][k] = 1;
                }
            }
        }
        System.out.println(&#34;RowOrder : &#34; + (System.currentTimeMillis() - theTime));
    }

    void columnOrderTest() {
        int theArray[][][] = new int[SIZE][SIZE][SIZE];
        long theTime = System.currentTimeMillis();
        for (int k = 0; k &lt;SIZE; k++) {
            for (int j = 0; j &lt;SIZE; j++) {
                for (int i = 0; i &lt;SIZE; i++) {
                    theArray[i][j][k] = 1;
                }
            }
        }
        System.out.println(&#34;ColumnOrder : &#34; + (System.currentTimeMillis() - theTime));
    }

    void arrayTest1() {

        long theCounter = 0;

        int theArray[] = new int[SIZE*SIZE*SIZE];
        long theTime = System.currentTimeMillis();
        for (int i = 0; i &lt;SIZE; i++) {
            for (int j = 0; j &lt;SIZE; j++) {
                for (int k = 0; k &lt;SIZE; k++) {
                    theArray[i*SIZE*SIZE+j*SIZE+k] = 1;
                    theCounter++;
                }
            }
        }
        System.out.println(&#34;ArrayTest1 : &#34; + (System.currentTimeMillis() - theTime) + &#34; #&#34; + theCounter);
    }

    void arrayTest2() {

        int theArray[] = new int[SIZE*SIZE*SIZE];
        long theTime = System.currentTimeMillis();
        Arrays.fill(theArray, 0);
        System.out.println(&#34;ArrayTest2 : &#34; + (System.currentTimeMillis() - theTime));
    }

    void arrayTest3() {

        int theCounter = 0;

        int theArray[] = new int[SIZE*SIZE*SIZE];
        long theTime = System.currentTimeMillis();
        for (int i = 0; i &lt;SIZE; i++) {
            for (int j = 0; j &lt;SIZE; j++) {
                for (int k = 0; k &lt;SIZE; k++) {
                    theArray[theCounter] = 1;
                    theCounter++;
                }
            }
        }
        System.out.println(&#34;ArrayTest3 : &#34; + (System.currentTimeMillis() - theTime) + &#34; #&#34; + theCounter);
    }

     public static void main(String[] args) {
        CacheTest theTest = new CacheTest();
        theTest.rowOrderTest();
        theTest.columnOrderTest();
        theTest.arrayTest1();
        theTest.arrayTest2();
        theTest.arrayTest3();
    }
}</code></pre></div></div><div class="paragraph"><p>The rowOrderTest() Method finishes on my machine within 42ms, the columnOrderTest() Method takes about 2195ms to complete, so it is more than 50 times slower than rowOrderTest(), but it does exactly the same! The columnOrderTest() Method just trashes the VM and CPU read ahead caches, so this explains the deadly slow down. This effect can be reproduced with long and byte as data types also.</p></div><div class="paragraph"><p>Some unexpected results are coming from the arrayTest1(), arrayTest2() and arrayTest3() Methods. Here i do not use a three dimensional array, i use a one dimensional array and emulate the other dimensions by offset multiplication. The arrayTest1() Method includes some little math to compute the array index, but on my machine it takes about 33ms to complete, so almost as fast as the rowOrderTest() Method. The arrayTest2() Method uses the SDK Array.fill Method to complete the task, and it still takes about 33ms to complete. The manual array fill in arrayTest3() takes about 36ms to complete, which is almost as fast as Array.fill(). Under the hood, Arrays.fill() does nothing else, so this is not surprising.</p></div><div class="paragraph"><p>Always check for array indexes and iteration algorithms, there might be room for performance improvements. From a performance point of view the best would be to avoid multi dimensional arrays at all and use other data structures.</p></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2013/10/java-se-context-and-dependency-injection-with-java-ee-support/">Enabling Java EE Features in CDI SE: A Portable Extension Magic Trick</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2013/11/java-properties-reinvented/">Type-Safe Property Access in Java: The Owner Library Revolution</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/2e692ad1fff282e93d9fa3fdd726190d7e7afd82" target="_blank">2e692ad</a></p></article></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://x.com/mirkosertic" itemprop="url"><i class="fa fa-x-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>