<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Building a Google-Style Search Parser for Lucene: Simple Yet Powerful &middot; Mirko Sertic</title><meta name="description" content="Transform your Lucene searches into Google-like magic with this nifty query parser implementation! Supporting everything from basic term searches to fuzzy matching and phrase queries, this code snippet makes complex search operations feel like a breeze."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="Building a Google-Style Search Parser for Lucene: Simple Yet Powerful"><meta property="og:description" content="Transform your Lucene searches into Google-like magic with this nifty query parser implementation! Supporting everything from basic term searches to fuzzy matching and phrase queries, this code snippet makes complex search operations feel like a breeze."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2013/04/google-style-query-parser-for-apache-lucene/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"><script>var _paq = window._paq = window._paq || [];
         
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//analytics.mirkosertic.de/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();</script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="My personal Technology Radar">Technology Radar</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><div class="contentbox"><h1 class="post-title" itemprop="name headline">Building a Google-Style Search Parser for Lucene: Simple Yet Powerful</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2013-04-26" itemprop="datePublished">Fri, Apr 26, 2013</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://x.com/mirkosertic" rel="author">Mirko Sertic</a></span></span></p><p class="post-abstract" itemprop="abstract"><span>This article presents a custom implementation of a Google-style query parser for Apache Lucene 4.2. The implementation supports various search features including basic term searches, phrase queries, fuzzy matching, and term negation. The parser handles different search syntaxes such as space-separated terms, quoted phrases, negation with minus signs, and fuzzy search with tilde operators. The provided Java implementation demonstrates how to convert these search patterns into Lucene&#39;s query types including BooleanQuery, PhraseQuery, and FuzzyQuery, making it easier to implement Google-like search functionality in Lucene-based applications.</span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>2 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/enterprise">Enterprise</a> ,<a href="/tags/interesting">Interesting</a> ,<a href="/tags/search">Search</a></span></p></div></header><figure class="blogtitleimage"><figcaption><p>Behold the masterpiece that AI hallucinated while reading this post:</p><p class="title">"How Little Query Parser Learned to Search Like Google"</p><p>(after I fed it way too many marketing blogs and memes)</p><p class="aidisclosure">Created using DALL-E 3</p></figcaption><img src="/media/welcomeimages/google-style-query-parser-for-apache-lucene_selected.png" alt="AI-Generated: How Little Query Parser Learned to Search Like Google" itemprop="image"></figure><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>I needed a query parser for Apache Lucene supporting Google style queries. Basically the following searches should be supported:</p></div><div class="paragraph"><p>mirko sertic → Should result in a BooleanQuery with “mirko” and “sertic” +mirko+sertic → Should result in a BooleanQuery with “mirko” and “sertic” +mirko +sertic → Should result in a BooleanQuery with “mirko” and “sertic” mirko sertic -klaus → Should result in a BooleanQuery with “mirko” and “sertic” but not “klaus” “mirko sertic” → Should result in a PhraeQuery with terms “mirko” and “sertic” in sequence mirko~ → Should result in a FuzzyQuery with “mirko”</p></div><div class="paragraph"><p>Unfortunately there is no default query parser implementation available, so i decided to implement my own one. Here is the code(for Lucene 4.2):</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">import org.apache.lucene.index.Term;
import org.apache.lucene.search.*;

import java.util.StringTokenizer;

public class QueryParser {

    private void addSubQuery(BooleanQuery aQuery, String aTerm, boolean aNegated, String aSearchField) {
        if (!aTerm.contains(&#34;*&#34;)) {
            if (aTerm.contains(&#34; &#34;)) {
                PhraseQuery thePhraseQuery = new PhraseQuery();
                for (StringTokenizer theTokenizer = new StringTokenizer(aTerm, &#34; &#34;); theTokenizer.hasMoreTokens();) {
                    String theToken = theTokenizer.nextToken();
                    thePhraseQuery.add(new Term(aSearchField, theToken));
                }
                thePhraseQuery.setSlop(1);
                if (aNegated) {
                    aQuery.add(thePhraseQuery, BooleanClause.Occur.MUST_NOT);
                } else {
                    aQuery.add(thePhraseQuery, BooleanClause.Occur.MUST);
                }
            } else {
                Query theQuery;
                if (!aTerm.endsWith(&#34;~&#34;)) {
                    theQuery = new TermQuery(new Term(aSearchField, aTerm));
                } else {
                    theQuery = new FuzzyQuery(new Term(aSearchField, aTerm.substring(0, aTerm.length() - 1)));
                }
                if (aNegated) {
                    aQuery.add(theQuery, BooleanClause.Occur.MUST_NOT);
                } else {
                    aQuery.add(theQuery, BooleanClause.Occur.MUST);
                }
            }
        } else {
            WildcardQuery theWildcardQuery = new WildcardQuery(new Term(aSearchField, aTerm));
            if (aNegated) {
                aQuery.add(theWildcardQuery, BooleanClause.Occur.MUST_NOT);
            } else {
                aQuery.add(theWildcardQuery, BooleanClause.Occur.MUST);
            }
        }
    }

    public Query parse(String aQuery, String aSearchField) {

        BooleanQuery theResult = new BooleanQuery();

        boolean isStringMode = false;
        boolean isNegated = false;
        StringBuilder theCurrentTerm = new StringBuilder();

        for (int i = 0; i &lt; aQuery.length(); i++) {
            char theCurrentChar = Character.toLowerCase(aQuery.charAt(i));
            if (theCurrentChar == &#39;\&#34;&#39;) {
                isStringMode = !isStringMode;
            } else {
                if (!isStringMode) {
                    switch (theCurrentChar) {
                        case &#39;-&#39;: {
                            if (theCurrentTerm.length() == 0) {
                                isNegated = true;
                            } else {
                                theCurrentTerm.append(theCurrentChar);
                            }
                            break;
                        }
                        case &#39;+&#39;:
                            if (theCurrentTerm.length() == 0) {
                                isNegated = false;
                            } else {
                                theCurrentTerm.append(theCurrentChar);
                            }
                            break;
                        case &#39; &#39;: {
                            addSubQuery(theResult, theCurrentTerm.toString(), isNegated, aSearchField);
                            theCurrentTerm = new StringBuilder();
                            isNegated = false;
                            break;
                        }
                        default: {
                            theCurrentTerm.append(theCurrentChar);
                            break;
                        }
                    }
                } else {
                    theCurrentTerm.append(theCurrentChar);
                }
            }
        }

        if (theCurrentTerm.length() &gt; 0) {
            addSubQuery(theResult, theCurrentTerm.toString(), isNegated, aSearchField);
        }

        return theResult;
    }
}</code></pre></div></div><div class="paragraph"><p>Stay tuned!</p></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2013/04/domain-driven-design-example/">A Domain-driven Design Example: From Chaos to Clean Architecture</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2013/04/a-javafx-based-desktop-search-engine/">Building a Better Desktop Search: A JavaFX and Lucene Powered Solution</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/2e692ad1fff282e93d9fa3fdd726190d7e7afd82" target="_blank">2e692ad</a></p></article></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://x.com/mirkosertic" itemprop="url"><i class="fa fa-x-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>