<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Building Resilient Spring Applications with Netflix Hystrix: A Simple AOP Approach &middot; Mirko Sertic</title><meta name="description" content="Transform your Spring application into a fault-tolerant powerhouse using Netflix Hystrix and the magic of AOP! With just a simple annotation and an aspect, you can add circuit breakers and monitoring capabilities to protect your services from failures, complete with a sleek dashboard to keep an eye on everything."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="Building Resilient Spring Applications with Netflix Hystrix: A Simple AOP Approach"><meta property="og:description" content="Transform your Spring application into a fault-tolerant powerhouse using Netflix Hystrix and the magic of AOP! With just a simple annotation and an aspect, you can add circuit breakers and monitoring capabilities to protect your services from failures, complete with a sleek dashboard to keep an eye on everything."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2012/07/how-to-embed-hystrix-into-existing-spring-applications/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"><script>(function() {
            
            function isDoNotTrackEnabled() {
                return navigator.doNotTrack === "1" ||
                    window.doNotTrack === "1" ||
                    navigator.msDoNotTrack === "1";
            }

            
            var hasConsent = false;

            
            function createConsentBanner() {
                
                if (isDoNotTrackEnabled()) {
                    initializeMatomo(false);
                    return;
                }

                var banner = document.createElement('div');
                banner.style.cssText = `
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f8f8f8;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            text-align: center;
        `;

                banner.innerHTML = `
            <p>We use cookies to improve your browsing experience.
            Your browser's Do Not Track setting is currently: ${isDoNotTrackEnabled() ? 'Enabled' : 'Disabled'}.
            Do you consent to our use of cookies?</p>
            <button id="accept-cookies" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; margin-right: 10px; cursor: pointer;">
                Accept
            </button>
            <button id="reject-cookies" style="background-color: #f44336; color: white; border: none; padding: 10px 20px; cursor: pointer;">
                Reject
            </button>
        `;

                document.body.appendChild(banner);

                
                document.getElementById('accept-cookies').addEventListener('click', function() {
                    hasConsent = true;
                    banner.style.display = 'none';
                    localStorage.setItem('matomoConsent', 'accepted');
                    initializeMatomo(true);
                });

                
                document.getElementById('reject-cookies').addEventListener('click', function() {
                    hasConsent = false;
                    banner.style.display = 'none';
                    localStorage.setItem('matomoConsent', 'rejected');
                    initializeMatomo(false);
                });
            }

            
            function initializeMatomo(trackingAllowed) {
                var _paq = window._paq = window._paq || [];

                
                if (isDoNotTrackEnabled()) {
                    trackingAllowed = false;
                }

                if (trackingAllowed) {
                    _paq.push(['requireConsent']);

                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);

                    var u="//analytics.mirkosertic.de/";
                    _paq.push(['setTrackerUrl', u+'matomo.php']);
                    _paq.push(['setSiteId', '2']);

                    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
                }
            }

            
            function checkPreviousConsent() {
                
                if (isDoNotTrackEnabled()) {
                    initializeMatomo(false);
                    return;
                }

                var storedConsent = localStorage.getItem('matomoConsent');
                if (storedConsent === 'accepted') {
                    console.log("Tracking accepted");
                    hasConsent = true;
                    initializeMatomo(true);
                } else if (storedConsent === 'rejected') {
                    console.log("Tracking rejected");
                    hasConsent = false;
                    initializeMatomo(false);
                } else {
                    
                    createConsentBanner();
                }
            }

            
            function init() {
                checkPreviousConsent();
            }

            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();</script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="My personal Technology Radar">Technology Radar</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Essential Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><div class="contentbox"><h1 class="post-title" itemprop="name headline">Building Resilient Spring Applications with Netflix Hystrix: A Simple AOP Approach</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2012-07-31" itemprop="datePublished">Tue, Jul 31, 2012</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://x.com/mirkosertic" rel="author">Mirko Sertic</a></span></span></p><p class="post-abstract" itemprop="abstract"><span>This guide demonstrates how to integrate Netflix Hystrix into existing Spring applications using Aspect-Oriented Programming (AOP). By implementing a custom @CircuitBreaker annotation and corresponding aspect, developers can easily add fault tolerance patterns to their service interfaces. The integration includes monitoring capabilities through the Hystrix Dashboard, allowing real-time visualization of service health and circuit breaker status. The approach is non-invasive and requires minimal changes to existing code, making it an elegant solution for improving application resilience.</span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>2 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/modernization">Modernization</a> ,<a href="/tags/springboot">SpringBoot</a> ,<a href="/tags/web">Web</a></span></p></div></header><figure class="blogtitleimage"><figcaption><p>Behold the masterpiece that AI hallucinated while reading this post:</p><p class="title">"How Little Spring Learned to Bounce Back: A Tale of Circuit Breakers and Resilience"</p><p>(after I fed it way too many marketing blogs and memes)</p><p class="aidisclosure">Created using DALL-E 3</p></figcaption><img src="/media/welcomeimages/how-to-embed-hystrix-into-existing-spring-applications_selected.png" alt="AI-Generated: How Little Spring Learned to Bounce Back: A Tale of Circuit Breakers and Resilience" itemprop="image"></figure><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>Netflix <a href="https://github.com/Netflix/Hystrix">Hystrix</a> is a very powerful framework to build fault tolerant and resilient applications. It provides common implementations for patterns like Timeout, <a href="http://martinfowler.com/bliki/CircuitBreaker.html">CircuitBreaker</a> and others. It also comes with nice monitoring capabilities using the Hystrix Dashboard or even JMX.</p></div><div class="paragraph"><p>Now, Hystrix should be used as a kind of decorator around interfaces or gateways to other (sub) systems. The tricky part is to do this in a non invasive manner. And here comes Spring and AOP to play:</p></div><div class="paragraph"><p>Consider the following class:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">package de.mirkosertic;

import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

import java.util.Random;

@Service
@Scope(&#34;singleton&#34;)
public class RandomBean {

    private final Random random;

    public RandomBean() {
        random = new Random();
    }

    @CircuitBreaker
    public String random() {
        return &#34;Random &#34; + random.nextInt();
    }
}</code></pre></div></div><div class="paragraph"><p>The RandomBean can be a gateway to some remote service. Do you see the @CircuitBreaker annotation? This marks the method as to be “protected” and “monitored” by Hystrix. But what is going on under the hood? The @CircuitBreaker annotation works together with an AOP around advice, and this advice encapsulates the whole Hystrix logic, as seen here:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">package de.mirkosertic.aspect;

import com.netflix.hystrix.HystrixCommand;
import com.netflix.hystrix.HystrixCommandGroupKey;
import com.netflix.hystrix.HystrixCommandKey;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;

import org.springframework.stereotype.Component;

@Aspect
@Component
public class CircuitBreakerAspect {

    @Around(&#34;@annotation(de.mirkosertic.CircuitBreaker)&#34;)
    public Object circuitBreakerAround(final ProceedingJoinPoint aJoinPoint) throws Throwable {
        String theShortName = aJoinPoint.getSignature().toShortString();
        HystrixCommand.Setter theSetter =
                HystrixCommand.Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(theShortName));
        theSetter = theSetter.andCommandKey(HystrixCommandKey.Factory.asKey(theShortName));
        HystrixCommand theCommand = new HystrixCommand(theSetter) {
            @Override
            protected Object run() throws Exception {
                try {
                    return aJoinPoint.proceed();
                } catch (Exception e) {
                    throw e;
                } catch (Throwable e) {
                    throw new Exception(e);
                }
            }
        };
        return theCommand.execute();
    }
}</code></pre></div></div><div class="paragraph"><p>Nice! But how to we add Hystrix monitoring capabilities to our app? We just need to add a small Servlet to our web.xml, as seen here:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;servlet&gt;
        &lt;display-name&gt;HystrixMetricsStreamServlet&lt;/display-name&gt;
        &lt;servlet-name&gt;HystrixMetricsStreamServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HystrixMetricsStreamServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/hystrix.stream&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;</code></pre></div></div><div class="paragraph"><p>And the monitoring can be done using the Hystrix Dashboard app, as seen here:</p></div><div class="paragraph"><p><span class="image"><img src="/media/hystrixdashboard.png" alt="hystrixdashboard"></span></p></div><div class="paragraph"><p>Very nice! Using the Dashboard, we can monitor the throughput of the service interface and we can also see the status of the circuit breaker and other statistics. The sources and examples of this tutorial are available at <a href="https://github.com/mirkosertic/HystrixSpring">github.com/mirkosertic/HystrixSpring</a>. Yes, resilience, here we go!</p></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2012/07/enterprise-search-with-apache-solr/">Building a Enterprise Search Engine in One Day with Apache Solr</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2012/07/thread-tracking-or-how-to-know-who-causes-an-error/">Smart Thread Naming: Your Secret Weapon for Debugging Multi-User Applications</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/2e692ad1fff282e93d9fa3fdd726190d7e7afd82" target="_blank">2e692ad</a></p></article></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://x.com/mirkosertic" itemprop="url"><i class="fa fa-x-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>