<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Building a Enterprise Search Engine in One Day with Apache Solr &middot; Mirko Sertic</title><meta name="description" content="Transform your file system into a powerful searchable knowledge base using Apache Solr&#39;s magic in just 24 hours! With a simple crawler, content extraction, and a Google-like UI, finding documents becomes as easy as pie - including cool features like similarity search and duplicate detection."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="Building a Enterprise Search Engine in One Day with Apache Solr"><meta property="og:description" content="Transform your file system into a powerful searchable knowledge base using Apache Solr&#39;s magic in just 24 hours! With a simple crawler, content extraction, and a Google-like UI, finding documents becomes as easy as pie - including cool features like similarity search and duplicate detection."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2012/07/enterprise-search-with-apache-solr/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"><script>var _paq = window._paq = window._paq || [];
         
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//analytics.mirkosertic.de/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();</script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="My personal Technology Radar">Technology Radar</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><div class="contentbox"><h1 class="post-title" itemprop="name headline">Building a Enterprise Search Engine in One Day with Apache Solr</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2012-07-30" itemprop="datePublished">Mon, Jul 30, 2012</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://x.com/mirkosertic" rel="author">Mirko Sertic</a></span></span></p><p class="post-abstract" itemprop="abstract"><span>This tutorial demonstrates how to build a complete enterprise search solution using Apache Solr in just one day. It covers the installation of Solr, implementation of a file system crawler using SolrJ, and creation of a search interface with highlighting and similarity search features. The solution includes content extraction from various document formats using Apache Tika and provides a Google-like search experience with advanced features like MoreLikeThis for finding similar documents and detecting duplicates.</span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>5 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/enterprise">Enterprise</a> ,<a href="/tags/search">Search</a> ,<a href="/tags/user-interface">User Interface</a></span></p></div></header><figure class="blogtitleimage"><figcaption><p>Behold the masterpiece that AI hallucinated while reading this post:</p><p class="title">"How Little Solr Found All The Lost Documents"</p><p>(after I fed it way too many marketing blogs and memes)</p><p class="aidisclosure">Created using DALL-E 3</p></figcaption><img src="/media/welcomeimages/enterprise-search-with-apache-solr_selected.png" alt="AI-Generated: How Little Solr Found All The Lost Documents" itemprop="image"></figure><article class="post-content clearfix" itemprop="articleBody"><div class="paragraph"><p>It you want to build a enterprise search engine, you don’t have to reinvent the wheel. You can use open source engines like <a href="http://lucene.apache.org/core/">Apache Lucene</a> or if you have just one day to implement it <a href="http://lucene.apache.org/solr/">Apache Solr</a>. Solr is a full blown enterprise search server, which comes with a lot of bundled plugins like meta-data and content extraction from a very common set of document types with <a href="http://tika.apache.org/">Apache Tika</a> , search highlighting, fragmented search and also similarity search for search results. This is a short tutorial how to create a search application within one day.</p></div><div class="sect1"><h2 id="_install_apache_solr">Install Apache Solr</h2><div class="sectionbody"><div class="paragraph"><p>By the time of writing, i am using Apache Solr 3.6.0. There is a wide range of ways how you can install it. Out of the box it comes with an embedded Jetty. But if you plan to use it in production, go the way and install it on a Tomcat. See the project documentation how to do that. It is quite easy. Take care that you install the right set of plugins into your SolrHome directory.</p></div></div></div><div class="sect1"><h2 id="_create_a_simple_crawler">Create a simple crawler</h2><div class="sectionbody"><div class="paragraph"><p>Solr by itself is just the search server. We need to build a crawler to feed the search server with content, and we also need to build a UI to ask the server for query results. Solr provides an API called SolrJ to connect with the server. We don’t have to deal with the content extraction, as we only need to submit the content to the server, so the crawler code is quite simple. Here is an example of a simple single threaded crawler:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">/**
 * Implementierung eines File System Crawlers.
 */
public class FileSystemCrawler {

    private SolrServer solrServer;

    private int documentProcessed;
    private long processingTime;
    private long volume;

    private FileSystemCrawler() throws MalformedURLException {
        solrServer = SolrServiceLocator.localeSolr();
    }

    private boolean isFileAccepted(File aFile) {
        String theFilename = aFile.getName().toLowerCase();

        return theFilename.endsWith(&#34;.doc&#34;) || theFilename.endsWith(&#34;.docx&#34;)
            || theFilename.endsWith(&#34;.pdf&#34;) || theFilename.endsWith(&#34;.msg&#34;)
            || theFilename.endsWith(&#34;.ppt&#34;) || theFilename.endsWith(&#34;.pptx&#34;);
    }

    public synchronized void notifyProcessingOfDocumentDone(long aDuration, long aVolume) {
        documentProcessed++;
        processingTime += aDuration;
        volume += aVolume;

        System.out.println(documentProcessed + &#34; Documents processed, total time &#34; +
		processingTime + &#34;ms, size of data &#34; + (int) (volume / 1024) + &#34;kb&#34;);
    }

    public void crawl(File aFile) throws IOException, SolrServerException {
        if (aFile.canRead()) {
            if (aFile.isDirectory()) {

                System.out.println(&#34;Scanning directory &#34; + aFile);

                for (File theFile : aFile.listFiles()) {
                    crawl(theFile);
                }
            } else {

                if (aFile.length() &lt;5 * 1024 * 1024 &amp;amp;&amp;amp; isFileAccepted(aFile)) {

                    try {
                        long theTime = System.currentTimeMillis();

                        ContentStreamUpdateRequest up
                                = new ContentStreamUpdateRequest(&#34;/update/extract&#34;);

                        up.addFile(aFile);

                        up.setParam(&#34;literal.id&#34;, aFile.toString());
                        up.setParam(&#34;uprefix&#34;, &#34;attr_&#34;);
                        up.setParam(&#34;fmap.content&#34;, SolrConfig.FT_SEARCH_FIELD);

                        up.setAction(AbstractUpdateRequest.ACTION.COMMIT, true, true);

                        solrServer.request(up);

                        long theDuration = System.currentTimeMillis() - theTime;
                        notifyProcessingOfDocumentDone(theDuration, aFile.length());
                    } catch (Exception e) {
                        System.out.println(&#34;Error uploading file &#34; + aFile + &#34; : &#34; + e.getMessage());
                    }
                }
            }
        }
    }

    public void waitForComplete() throws IOException, SolrServerException {
        solrServer.commit();
    }

    public static void main(String[] args) throws IOException, SolrServerException {
        FileSystemCrawler theCrawler = new FileSystemCrawler();
        theCrawler.crawl(new File(&#34;C:\\&#34;));
        theCrawler.waitForComplete();
    }
}</code></pre></div></div><div class="paragraph"><p>This will crawl your local hard disk and submit some files to the index using SolrJ. Quite easy, right?</p></div></div></div><div class="sect1"><h2 id="_create_a_search_user_interface">Create a search user interface</h2><div class="sectionbody"><div class="paragraph"><p>I will use a very simple JSP page to query the index. It looks like google and also provides similarity search for a set of documents. Here is the source code(For security reasons the import statements where stripped, but they can be easily added by your IDE):</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-html" data-lang="html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Solr Search&lt;/title&gt;
    &lt;style type=&#34;text/css&#34;&gt;
        a {
            color: blue;
            font-weight: bold;
            text-decoration: underline;
        }

        .location1 {
            font-weight: normal;
            color: green;
            text-decoration: none;
        }

        .content1 {
            margin-bottom: 4mm;
        }

        .location2 {
            color: green;
            margin-left: 1cm;
            text-decoration: none;
            font-weight: normal;
        }

        .content2 {
            margin-left: 1cm;
        }

        em {
            color: #000000;
            font-weight: bold;
            font-style: normal;
        }

        .suchfeld {
            text-align: center;
        }

        .logo {
            text-align: center;
        }

        .error {
            color: red;
        }

        input {
            border: solid 1px gray;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
    String theQueryString = request.getParameter(&#34;querystring&#34;);
    if (theQueryString == null) {
        theQueryString = &#34;&#34;;
    }
%&gt;
&lt;div class=&#34;logo&#34;&gt;&lt;img src=&#34;logo.png&#34;&gt;&lt;/div&gt;

&lt;div class=&#34;suchfeld&#34;&gt;
    &lt;form method=&#34;post&#34;&gt;
        &lt;b&gt;Suchanfrage&lt;/b&gt;
        &lt;input name=&#34;querystring&#34; type=&#34;text&#34; size=&#34;100&#34; value=&#34;&lt;%=StringEscapeUtils.escapeHtml(theQueryString)%&gt;&#34;&gt;
        &lt;input type=&#34;submit&#34; value=&#34;Suchen!&#34;&gt;
    &lt;/form&gt;
    You will find Details zur Abfragesyntax finden Sie &lt;a href=&#34;http://lucene.apache.org/core/3_6_0/queryparsersyntax.html&#34;
                                            target=&#34;_blank&#34;&gt;hier&lt;/a&gt;
    &lt;br/&gt;&lt;br/&gt;
&lt;/div&gt;

&lt;%
    try {
        if (theQueryString.length()&gt; 0) {

            SolrServer solr = SolrServiceLocator.localeSolr();

            SolrQuery theQuery = new SolrQuery();
            theQuery.setRows(50);
            theQuery.setStart(0);
            theQuery.setHighlight(true);
            theQuery.setHighlightSnippets(5);
            theQuery.addHighlightField(SolrConfig.FT_SEARCH_FIELD);
            theQuery.setQuery(SolrConfig.FT_SEARCH_FIELD + &#34;:(&#34; + theQueryString + &#34;)&#34;);
            theQuery.add(&#34;mlt&#34;,&#34;true&#34;);
            theQuery.add(&#34;mlt.fl&#34;,SolrConfig.FT_SEARCH_FIELD);

            QueryResponse theResponse = solr.query(theQuery);

            NamedList&lt;Object&gt; theMoreLikeThis = (NamedList&lt;Object&gt;) theResponse.getResponse().get(&#34;moreLikeThis&#34;);
%&gt;

Die Suche wurde in &lt;%=theResponse.getElapsedTime()%&gt;ms ausgef&amp;amp;uuml;hrt.&lt;br/&gt;&lt;br/&gt;

&lt;%
    Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; theHighlighting = theResponse.getHighlighting();

    int docCount = 0;
    for (SolrDocument theDocument : theResponse.getResults()) {
        String theId = (String) theDocument.getFieldValue(SolrConfig.DOCUMENT_ID);

        int p = theId.lastIndexOf(&#39;\\&#39;);
        String theFilename = theId.substring(p + 1);

        StringBuffer theHighlightedText = new StringBuffer();
        Map&lt;String, List&lt;String&gt;&gt; theHighlight = theHighlighting.get(theId);
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; theEntry : theHighlight.entrySet()) {
            if (theEntry.getKey().equals(SolrConfig.FT_SEARCH_FIELD)) {
                for (String theValue : theEntry.getValue()) {
                    theHighlightedText.append(theValue);
                    theHighlightedText.append(&#34; &#34;);
                }
            }
        }
%&gt;

&lt;b&gt;&lt;a href=&#34;file:///&lt;%=theId.replace(&#34;:&#34;,&#34;|&#34;).replace(&#34;\\&#34;,&#34;/&#34;)%&gt;&#34; target=&#34;_blank&#34;&gt;&lt;%=theFilename%&gt;
&lt;/a&gt;&lt;/b&gt;&lt;br/&gt;
&lt;a href=&#34;file:///&lt;%=theId.replace(&#34;:&#34;,&#34;|&#34;).replace(&#34;\\&#34;,&#34;/&#34;)%&gt;&#34; target=&#34;_blank&#34; class=&#34;location1&#34;&gt;&lt;%=theId%&gt;&lt;/a&gt;
&lt;div class=&#34;content1&#34;&gt;&lt;%=theHighlightedText%&gt;&lt;/div&gt;
&lt;%
        List&lt;SolrDocument&gt; theMoreLikeThisDocuments =  (List&lt;SolrDocument&gt;)theMoreLikeThis.getVal(docCount);
        for (SolrDocument theSingleDocument : theMoreLikeThisDocuments) {
            theId = (String) theSingleDocument.getFieldValue(SolrConfig.DOCUMENT_ID);

            p = theId.lastIndexOf(&#39;\\&#39;);
            theFilename = theId.substring(p + 1);

            %&gt;
&lt;a href=&#34;file:///&lt;%=theId.replace(&#34;:&#34;,&#34;|&#34;).replace(&#34;\\&#34;,&#34;/&#34;)%&gt;&#34; target=&#34;_blank&#34; class=&#34;location2&#34;&gt;&lt;%=theId%&gt;&lt;/a&gt;&lt;br/&gt;
            &lt;%
        }
%&gt;
    &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
&lt;%
        docCount++;
        }
    }
} catch (Exception e) {
%&gt;

&lt;br/&gt;&lt;br/&gt;

&lt;div class=&#34;error&#34;&gt;&lt;%=e.getMessage()%&gt;&lt;br/&gt;
    &lt;pre&gt;&lt;% e.printStackTrace(new PrintWriter(out));%&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;%
    }
%&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div></div><div class="sect1"><h2 id="_the_result">The result</h2><div class="sectionbody"><div class="paragraph"><p>Here is an example of our crawler and the ui in action. Looks quite nice, right? You will get a list of found documents. You will also see the Solr MoreLikeThis Feature in action. For every found result, a set of documents which are “similar” to this one are also displayed. Using MoreLikeThis, you can also detect duplicate files.</p></div><div class="paragraph"><p><span class="image"><img src="/media/solrui.png" alt="solrui"></span></p></div></div></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2012/07/software-defect-detection-with-aop-and-jsr-303-jsr-305-jsr-308/">Nullpointer-free Java: Combining AOP with Modern Validation Standards</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2012/07/how-to-embed-hystrix-into-existing-spring-applications/">Building Resilient Spring Applications with Netflix Hystrix: A Simple AOP Approach</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/2e692ad1fff282e93d9fa3fdd726190d7e7afd82" target="_blank">2e692ad</a></p></article></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://x.com/mirkosertic" itemprop="url"><i class="fa fa-x-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.highlightAll();
        });
    }</script></body></html>