<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>A first touch with NoSQL, graph databases and OrientDB &middot; Mirko Sertic</title><meta name="description" content="I was thinking about the current way we often store data in relational databases like MySQL, PostgreSQL or Oracle. We are using object-relational mapping frameworks like Hibernate, enriching Java classes with JPA annotations and are hoping that the mapping framework does everything for us the right way."><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="robots" content="index,follow"><meta property="og:title" content="A first touch with NoSQL, graph databases and OrientDB"><meta property="og:description" content="I was thinking about the current way we often store data in relational databases like MySQL, PostgreSQL or Oracle. We are using object-relational mapping frameworks like Hibernate, enriching Java classes with JPA annotations and are hoping that the mapping framework does everything for us the right way."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mirkosertic.de/blog/2012/08/a-first-touch-with-nosql-graph-databases-and-orientdb/"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://www.mirkosertic.de/css/site.css" rel="stylesheet" media="screen"><link rel="shortcut icon" type="image/x-icon" href="https://www.mirkosertic.de/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.mirkosertic.de/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://www.mirkosertic.de/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://www.mirkosertic.de/favicon-16x16.png"><link rel="manifest" href="https://www.mirkosertic.de/manifest.json"><link rel="mask-icon" href="https://www.mirkosertic.de/safari-pinned-tab.svg" color="#5bbad5"><script src="https://polyfill.io/v2/polyfill.min.js?features=default,IntersectionObserver"></script><meta name="theme-color" content="#ffffff"><script>var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-33614060-2', 'auto');
	
	ga('send', 'pageview');
}</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><header><nav class="navbar navbar-expand-md navbar-dark fixed-top" itemscope itemtype="http://www.schema.org/SiteNavigationElement"><div class="container"><a class="navbar-brand" href="https://www.mirkosertic.de/">www.mirkosertic.de</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/toolsgoodies" title="Tools &amp; Goodies">Tools &amp; Goodies</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/interestingbooks" title="Interesting Books">Interesting Books</a></li><li class="nav-item"><a itemprop="url" class="nav-link" href="/global/favorites" title="My favorite postings">My favorite postings</a></li><li class="nav-item"><a itemprop="url" class="nav-link active" href="/post/" title="Blog">Blog</a></li></ul></div></div></nav></header><main role="main"><div itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">A first touch with NoSQL, graph databases and OrientDB</h1><p class="post-date"><span class="icon"><i class="fa fa-calendar-check-o-white"></i></span><time datetime="2012-08-01" itemprop="datePublished">Wed, Aug 1, 2012</time> <span>by</span> <span itemprop="author" itemscope="" itemtype="https://schema.org/Person"><span itemprop="name"><a href="https://twitter.com/mirkosertic" itemprop="url" rel="author">Mirko Sertic</a></span></span></p><p><span class="icon"><i class="fa fa-clock-white"></i></span><span>3 Minutes reading time</span></p><p class="post-tags"><span class="tag"><span class="icon"><i class="fa fa-tags-white"></i></span><a href="/tags/enterprise">Enterprise</a></span> ,&nbsp;<a href="/tags/nosql">NoSQL</a></p></header><article class="post-content clearfix" itemprop="articleBody"><div class="sect1"><h2 id="_the_experiment">The experiment</h2><div class="sectionbody"><div class="paragraph"><p>I was thinking about the current way we often store data in relational databases like MySQL, PostgreSQL or Oracle. We are using object-relational mapping frameworks like Hibernate, enriching Java classes with JPA annotations and are hoping that the mapping framework does everything for us the right way.</p></div><div class="paragraph"><p>But wait a minute. What are we storing here? Basically we are storing Java object graphs using our ORM framework. Object graphs. Ok, so why could be not use a graph database to store our objects directly? Shouldn’t this make our life easier, no more database table definitions, indexes, foreign keys? Lets give it a try and test how we can migrate an existing JPA based application to a NoSQL graph database. Although i could implement a new persistence layer and use technologies like <a href="http://www.springsource.org/spring-data/neo4j">SpringData Neo4J</a> , i want to to check if there are JPA compatible solutions around.</p></div><div class="paragraph"><p>After some research, i discovered <a href="http://www.orientdb.org/orient-db.htm">OrientDB</a>. Basically it is a hybrid graph/document database and belongs to the NoSQL group. It has a very small footprint, supports inheritance, can run in schema, schemaless and hybrid mode and has also support for storing JPA annotated Java objects. Let’s give t a try.</p></div><div class="paragraph"><p>We have three entities, a Partner has many PartnerHistory entities, which are associated with a HistoryType. Here is some code persisting a simple object graph:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class OrientTest1 {

    public static void main(String args[]) {
        // OPEN THE DATABASE
        OObjectDatabaseTx db = new OObjectDatabaseTx(&#34;remote:localhost/mirko&#34;).open(&#34;admin&#34;, &#34;admin&#34;);

        // REGISTER THE CLASS ONLY ONCE AFTER THE DB IS OPEN/CREATED
        db.getEntityManager().registerEntityClass(Partner.class);
        db.getEntityManager().registerEntityClass(PartnerHistory.class);
        db.getEntityManager().registerEntityClass(HistoryType.class);

        HistoryType theType = new HistoryType();
        theType.setDescription(&#34;History Type &#34; + new Timestamp(System.currentTimeMillis()).toString());

        Partner thePartner = new Partner();
        thePartner.setName1(&#34;Luke&#34;);
        thePartner.setName2(&#34;Skywalker&#34;);

        for (int i = 0; i &lt;3; i++) {
            PartnerHistory theHistory = new PartnerHistory();
            theHistory.setDescription(&#34;History &#34; + i + new Timestamp(System.currentTimeMillis()).toString());
            theHistory.setType(theType);
            thePartner.getHistory().add(theHistory);
        }

        db.save(thePartner);
    }
}</code></pre></div></div><div class="paragraph"><p>This example opens a connection to the OrientDB server, and registers a set classes to persist. Using the Orient <a href="http://code.google.com/p/orient/wiki/ObjectDatabase">ObjectDatabase</a> feature, which is basically a JPA wrapper around the OrientDB core, it discovers JavaBean properties with getters and setters and also detects JPA annotations.</p></div><div class="paragraph"><p>Next it creates a simple object graph and stores it. The graph database can be explored with <a href="http://code.google.com/p/orient/wiki/OrientDB_Studio">OrientDB Studio</a>. Let´s check what was persisted:</p></div><div class="ulist"><ul><li><p>One Partner entity</p></li><li><p>Three PartnerHistory entities</p></li><li><p>Three HistoryType entities</p></li></ul></div><div class="paragraph"><p>Wait, this is wrong. There are three HistoryTypes entities, but there should be only one! At the time of writing, OrientDB release 1.1.0 was used. It has a very leaky implementation of JPA support. It has no such concept like sessions or first level cache. We have to provide some information to help the ObjectDatabase layer:</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class OrientTest2 {


    public static void main(String args[]) {
        // OPEN THE DATABASE
        OObjectDatabaseTx db = new OObjectDatabaseTx(&#34;remote:localhost/mirko&#34;).open(&#34;admin&#34;, &#34;admin&#34;);

        // REGISTER THE CLASS ONLY ONCE AFTER THE DB IS OPEN/CREATED
        db.getEntityManager().registerEntityClass(Partner.class);
        db.getEntityManager().registerEntityClass(PartnerHistory.class);
        db.getEntityManager().registerEntityClass(HistoryType.class);

        HistoryType theType = db.newInstance(HistoryType.class);
        theType.setDescription(&#34;HistoryType &#34; + new Timestamp(System.currentTimeMillis()).toString());

        Partner thePartner = new Partner();
        thePartner.setName1(&#34;Luke&#34;);
        thePartner.setName2(&#34;Skywalker&#34;);

        for (int i = 0; i &lt;3; i++) {
            PartnerHistory theHistory = new PartnerHistory();
            theHistory.setDescription(&#34;History &#34; + i + new Timestamp(System.currentTimeMillis()).toString());
            theHistory.setType(theType);
            thePartner.getHistory().add(theHistory);
        }

        db.save(thePartner);
    }
}</code></pre></div></div><div class="paragraph"><p>Here we create an ObjectDatabase proxy for the HistoryType entitiy, and reuse it for creating the object graph. Let’s check what is persisted now:</p></div><div class="ulist"><ul><li><p>One Partner entity</p></li><li><p>Three PartnerHistory entities</p></li><li><p>One HistoryType entity</p></li></ul></div><div class="paragraph"><p>This is correct. We have migrated the first use case from Hibernate/JPA to OrientDB.</p></div></div></div><div class="sect1"><h2 id="_conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>OrientDBs ObjectDatabase is a very promising candidate for migrating existing applications to a graph based storage approach. But it is missing some very important concepts like sessions or the first level cache. Creating proxies for reused objects is cumbersome, as detecting the same object in the graph can be easily done if the classes implement the equals() and hashCode() methods correctly. If this feature would be implemented, it would be a great enhancement to the API.</p></div></div></div><div class="metainfo"><span>&lt;&lt;Pevious posting: <a href="https://www.mirkosertic.de/blog/2012/07/thread-tracking-or-how-to-know-who-causes-an-error/">Thread tracking or how to know who causes an error</a></span> <span>Next posting: <a href="https://www.mirkosertic.de/blog/2012/08/the-law-of-leaky-abstractions/">The law of leaky abstractions</a>&gt;&gt;</span></div><p><i class="fa fa-github"></i>Git revision: <a href="https://github.com/mirkosertic/www_mirkosertic_de/commit/63a36b07236d1869ff91cec0ebccf5aa005e0057" target="_blank">63a36b0</a></p></article></div><div class="comments"><div id="disqus-placeholder">Loading comments...</div><div id="disqus_thread"></div><script>'use strict';
        window.addEventListener("load", function(event) {
            var disqusLoaded = false;
            var disqusObserver = new IntersectionObserver(function(entries, observer) {
                entries.forEach(function(entry) {
                    if (!disqusLoaded && entry.isIntersecting) {
                        console.log("Loading Disqus");
                        disqusLoaded = true;

                        document.getElementById('disqus-placeholder').remove();

                        
                        var script = document.createElement('script');
                        script.src = '//www-mirkosertic-de.disqus.com/embed.js';
                        script.async = true;
                        script.setAttribute('data-timestamp', +new Date());
                        script.addEventListener('load', function () {
                            
                            DISQUS.reset({reload: true, config: false});
                        });
                        (document.head || document.body).appendChild(script);
                    }
                });
            }, {
                root: null,
                rootMargin: "0px",
                threshold: [0]
            });
            disqusObserver.observe(document.querySelector(".comments"));
        }, false);</script></div></main><footer><p>&copy; Mirko Sertic &middot; <a href="https://www.mirkosertic.de/global/impressum/index.html">Imprint / Impressum</a></p><address><strong itemprop="name">Mirko Sertic</strong><div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"><div itemprop="streetAddress">Josefine-Mauser-Str. 66</div><div itemprop="postalCode">48157 Münster</div><div itemprop="addressCountry">Germany</div></div><a class="icon" target="_top" href="mailto:mirko@mirkosertic.de"><i class="fa fa-envelope-white"></i></a> <a class="icon" target="_blank" href="https://www.mirkosertic.de/index.xml" itemprop="url"><i class="fa fa-rss-white"></i></a> <a class="icon" target="_blank" href="https://www.xing.com/profile/Mirko_Sertic" itemprop="url"><i class="fa fa-xing-white"></i></a> <a class="icon" target="_blank" href="https://twitter.com/mirkosertic" itemprop="url"><i class="fa fa-twitter-white"></i></a> <a class="icon" target="_blank" href="https://github.com/mirkosertic" itemprop="url"><i class="fa fa-github-white"></i></a> <a class="icon" target="_blank" href="https://de.linkedin.com/in/mirko-sertic-98882397" itemprop="url"><i class="fa fa-linkedin-white"></i></a></address><p class="float-right"><a href="#">Back to top</a></p></footer><script src="https://www.mirkosertic.de/js/bootstrap-native-v4.min.js"></script><script>function existsByCSSSelector(aSelector) {
        var element = document.querySelector(aSelector);
        if (element) {
            return true;
        }
        return false;
    }

    var Loader = function () { };
    Loader.prototype = {
        require: function (scripts, callback) {
            this.loadCount = 0;
            this.totalRequired = scripts.length;
            this.callback = callback;

            for (var i=0;i<scripts.length;i++) {
                this.writeScript(scripts[i]);
            }
        },
        loaded: function (evt) {
            this.loadCount++;

            if (this.loadCount==this.totalRequired && typeof this.callback=='function') this.callback.call();
        },
        writeScript: function (src) {
            var self = this;
            var s = document.createElement('script');
            s.type = "text/javascript";
            s.async = true;
            s.src = src;
            s.addEventListener('load', function (e) { self.loaded(e); }, false);
            var head = document.getElementsByTagName('head')[0];
            head.appendChild(s);
        }
    };

    if (existsByCSSSelector("pre.highlight code") > 0) {
        var loader = new Loader();
        loader.require(["https:\/\/www.mirkosertic.de\/js/highlight-9.9.0.min.js"], function() {

            var additionalStylesheet = document.createElement('link');
            additionalStylesheet.rel = "stylesheet";
            additionalStylesheet.type = 'text/css';
            additionalStylesheet.media = "screen";
            additionalStylesheet.href = "https:\/\/www.mirkosertic.de\/css/highlight.css";

            var head = document.getElementsByTagName('head')[0];
            head.appendChild(additionalStylesheet);

            hljs.initHighlightingOnLoad();
        });
    }</script></body></html>